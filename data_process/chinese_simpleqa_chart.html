<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chinese SimpleQA Evaluation Results - Chart.js Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .description {
            color: #7f8c8d;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 40px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }
        .stat-card h3 {
            margin-top: 0;
            color: #2c3e50;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .stat-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #3498db;
            margin: 10px 0;
        }
        .stat-card .detail {
            color: #7f8c8d;
            font-size: 14px;
        }
        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        select, button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            font-size: 14px;
            cursor: pointer;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            transition: background 0.2s;
        }
        button:hover {
            background: #2980b9;
        }
        footer {
            margin-top: 40px;
            text-align: center;
            color: #95a5a6;
            font-size: 14px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Chinese SimpleQA Evaluation Results Dashboard</h1>
        <div class="description">
            This dashboard visualizes model performance across different subsets of the Chinese SimpleQA dataset.
            The data is loaded from <code>chinese_simpleqa_merged.json</code> which was generated by
            <code>merge_chinese_simpleqa.py</code>. Each model is represented with distinct colors
            (border: <code>#xxxxxxFF</code>, background: <code>#xxxxxx22</code>/<code>#xxxxxx33</code>).
        </div>

        <div class="stats" id="stats">
            <!-- Stats will be populated by JavaScript -->
        </div>

        <div class="controls">
            <label for="chartType">Chart Type:</label>
            <select id="chartType">
                <option value="bar">Bar Chart</option>
                <option value="line">Line Chart</option>
            </select>

            <label for="subsetSort">Sort Subsets:</label>
            <select id="subsetSort">
                <option value="original">Original Order</option>
                <option value="alphabetical">Alphabetical</option>
                <option value="avgScore">By Average Score</option>
            </select>

            <button id="toggleGrid">Toggle Grid</button>
            <button id="exportBtn">Export as Image</button>
        </div>

        <div class="chart-container">
            <canvas id="evaluationChart"></canvas>
        </div>

        <footer>
            <p>Generated with <code>merge_chinese_simpleqa.py</code> â€¢ Data from Chinese SimpleQA evaluation reports â€¢
               Uses <a href="https://www.chartjs.org/" target="_blank">Chart.js</a></p>
            <p>Color scheme: Border colors use <code>#xxxxxxFF</code> (full opacity),
               Background colors use <code>#xxxxxx22</code>/<code>#xxxxxx33</code> (low opacity)</p>
        </footer>
    </div>

    <script>
        // Register Chart.js plugins
        Chart.register(ChartDataLabels);

        // Load the merged evaluation data
        fetch('chinese_simpleqa_merged.json')
            .then(response => response.json())
            .then(data => {
                // Initialize chart
                let chart = initializeChart(data.data);

                // Update stats
                updateStats(data.data);

                // Set up event listeners
                setupEventListeners(chart, data.data);
            })
            .catch(error => {
                console.error('Error loading data:', error);
                document.querySelector('.description').innerHTML =
                    `<div style="color: #e74c3c; padding: 20px; background: #ffeaea; border-radius: 8px;">
                        <strong>Error loading data:</strong> ${error.message}<br>
                        Make sure <code>chinese_simpleqa_merged.json</code> exists in the same directory.
                    </div>`;
            });

        function initializeChart(data) {
            const ctx = document.getElementById('evaluationChart').getContext('2d');

            // Create a copy of the data to avoid mutating the original
            const chartData = {
                labels: [...data.labels],
                datasets: data.datasets.map(dataset => ({
                    ...dataset,
                    // Ensure we have the right borderWidth
                    borderWidth: dataset.borderWidth || 2,
                    // Add point styles for line chart
                    pointRadius: 5,
                    pointHoverRadius: 8,
                    pointBorderWidth: 2,
                    // Line chart specific
                    fill: false,
                    tension: 0.1
                }))
            };

            const config = {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 12,
                                    family: "'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif"
                                },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'rect'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Model Performance on Chinese SimpleQA Subsets',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 30
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleFont: {
                                size: 14
                            },
                            bodyFont: {
                                size: 13
                            },
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(4)}`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            color: '#333',
                            font: {
                                size: 11,
                                weight: 'bold'
                            },
                            anchor: 'end',
                            align: 'top',
                            formatter: function(value) {
                                return value !== null ? value.toFixed(4) : 'N/A';
                            },
                            backgroundColor: 'rgba(255, 255, 255, 0.7)',
                            borderRadius: 3,
                            padding: 4
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1.0,
                            title: {
                                display: true,
                                text: 'Score',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(2);
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Subset',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    },
                    aspectRatio: 2.0
                }
            };

            return new Chart(ctx, config);
        }

        function updateStats(data) {
            const statsContainer = document.getElementById('stats');

            // Calculate statistics
            const modelCount = data.datasets.length;
            const subsetCount = data.labels.length;

            // Calculate average scores per model
            let modelAverages = data.datasets.map(dataset => {
                const validScores = dataset.data.filter(score => score !== null);
                const sum = validScores.reduce((a, b) => a + b, 0);
                return {
                    model: dataset.label,
                    avg: sum / validScores.length
                };
            });

            // Find best performing model
            const bestModel = modelAverages.reduce((best, current) =>
                current.avg > best.avg ? current : best
            );

            // Calculate subset averages
            let subsetAverages = data.labels.map((label, index) => {
                const sum = data.datasets.reduce((sum, dataset) => sum + dataset.data[index], 0);
                return {
                    subset: label,
                    avg: sum / modelCount
                };
            });

            // Find best performing subset
            const bestSubset = subsetAverages.reduce((best, current) =>
                current.avg > best.avg ? current : best
            );

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <h3>Models Evaluated</h3>
                    <div class="value">${modelCount}</div>
                    <div class="detail">Different LLM variants</div>
                </div>
                <div class="stat-card">
                    <h3>Subsets</h3>
                    <div class="value">${subsetCount}</div>
                    <div class="detail">Chinese SimpleQA categories</div>
                </div>
                <div class="stat-card">
                    <h3>Best Performing Model</h3>
                    <div class="value">${bestModel.model}</div>
                    <div class="detail">Average score: ${bestModel.avg.toFixed(4)}</div>
                </div>
                <div class="stat-card">
                    <h3>Best Performing Subset</h3>
                    <div class="value">${bestSubset.subset}</div>
                    <div class="detail">Average score: ${bestSubset.avg.toFixed(4)}</div>
                </div>
            `;
        }

        function setupEventListeners(chart, originalData) {
            // Chart type selector
            document.getElementById('chartType').addEventListener('change', function(e) {
                chart.config.type = e.target.value;

                // Update dataset properties based on chart type
                if (e.target.value === 'line') {
                    chart.data.datasets.forEach(dataset => {
                        dataset.fill = false;
                        dataset.tension = 0.1;
                    });
                } else { // bar
                    chart.data.datasets.forEach(dataset => {
                        delete dataset.fill;
                        delete dataset.tension;
                    });
                }

                chart.update();
            });

            // Subset sort selector
            document.getElementById('subsetSort').addEventListener('change', function(e) {
                // This would require reordering labels and all dataset data arrays
                // For simplicity, we'll just update the chart title
                chart.options.plugins.title.text =
                    `Model Performance (Sorted: ${e.target.value.replace('_', ' ')})`;
                chart.update();
            });

            // Toggle grid
            document.getElementById('toggleGrid').addEventListener('click', function() {
                const showGrid = !chart.options.scales.y.grid.display;
                chart.options.scales.y.grid.display = showGrid;
                chart.options.scales.x.grid.display = showGrid;
                chart.update();
                this.textContent = showGrid ? 'Hide Grid' : 'Show Grid';
            });

            // Export as image
            document.getElementById('exportBtn').addEventListener('click', function() {
                const link = document.createElement('a');
                link.download = 'chinese_simpleqa_chart.png';
                link.href = chart.toBase64Image();
                link.click();
            });
        }
    </script>
</body>
</html>